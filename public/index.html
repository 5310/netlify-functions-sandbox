<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/8.0.20/jsrsasign-all-min.js"></script>
</head>
<body>
<h1>Hullo world, Again!</h1>

<a href="/.netlify/functions/auth0">Login</a>
<a href="https://dev-n84xs2sw8tzfloyk.us.auth0.com/v2/logout?client_id=261aDeOPIiMTi1pYcuT8KcmlZF3usU9d&returnTo=https://sage-conkies-0fe563.netlify.app/">Logout</a>
<div id="profile"></div>

<script>
    const parseJWT = (token) => {
        var base64Url = token.split('.')[1]
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/')
        var jsonPayload = decodeURIComponent(window.atob(base64).split('').map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''))
        return JSON.parse(jsonPayload);
    }

    const params = new URLSearchParams(location.search)
    if (params.has('id_token')) {
        const id_token = params.get('id_token')
        const id_token_payload = parseJWT(id_token)
        const user_id = id_token_payload.sub
        
        window.history.replaceState({}, document.title, "/");

        console.log(id_token_payload)
        document.cookie = `user_id=${user_id}; Secure`
    }
</script>
</body>
  